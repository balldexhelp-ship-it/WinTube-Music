<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>WinTube Music</title>
<style>
body {
  font-family: "Segoe UI", "Frutiger", Arial, sans-serif;
  margin: 0;
  background: #f0f0f0;
}
/* Now Playing Bar */
#nowPlayingBar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: rgba(255,255,255,0.9);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  padding: 8px 20px;
  gap: 15px;
  z-index: 1000;
}
#nowPlayingInfo { flex: 1; font-weight: bold; }
#progressBar { width: 200px; }
#playPauseBtn { padding: 6px 12px; background: #4e9af1; color: white; border: none; border-radius: 6px; cursor: pointer; }

/* Push content down */
.page-content { margin-top: 60px; padding: 20px; }

/* Music Search & YouTube input */
.music-box { max-width: 800px; margin: auto; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.2); }
.music-box input { width: 60%; padding: 8px; margin-right: 10px; border-radius: 6px; border: 1px solid #ccc; }
.music-box button { padding: 8px 14px; background-color: #4e9af1; color: white; border: none; border-radius: 6px; cursor: pointer; margin-right:5px; }
.song-item { display: flex; align-items: center; gap: 15px; margin-top: 10px; padding: 8px; background: #f8f8f8; border-radius: 6px; }
.song-item img { width: 50px; height: 50px; border-radius: 6px; }
.song-item button { margin-left: auto; background-color: #ff6b81; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; }
#youtubePlayer { width: 100%; max-width: 800px; aspect-ratio:16/9; margin-top:20px; display:none; border-radius:8px; border:0; }
</style>
</head>
<body>

<div id="nowPlayingBar">
  <div id="nowPlayingInfo">No song playing</div>
  <input type="range" id="progressBar" value="0" min="0" max="100">
  <button id="playPauseBtn">Play</button>
</div>

<div class="page-content">
  <div class="music-box">
    <input type="text" id="musicSearch" placeholder="Search iTunes...">
    <button onclick="searchMusic()">Search iTunes</button>
    <input type="text" id="youtubeLink" placeholder="Paste YouTube link here">
    <button onclick="playYouTube()">Play YouTube</button>
    <div id="musicResults"></div>
  </div>
  <iframe id="youtubePlayer" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

<script>
const API_KEY = 'YOUR_YOUTUBE_API_KEY';
let currentAudio = null, progressInterval = null, isYouTube = false;

const nowPlayingTitle = document.getElementById('nowPlayingInfo');
const progressBar = document.getElementById('progressBar');
const playPauseBtn = document.getElementById('playPauseBtn');
const youtubePlayer = document.getElementById('youtubePlayer');

function searchMusic() {
  const query = document.getElementById('musicSearch').value.trim();
  if (!query) return alert("Enter a song or artist");
  fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=song&limit=10`)
    .then(res => res.json())
    .then(data => displayMusic(data.results))
    .catch(err => console.error(err));
}

function displayMusic(songs) {
  const container = document.getElementById('musicResults');
  container.innerHTML = "";
  if (!songs.length) return container.innerHTML = "<p>No songs found.</p>";
  songs.forEach(song => {
    const div = document.createElement('div');
    div.className = 'song-item';
    div.innerHTML = `<img src="${song.artworkUrl100}"><div>${song.trackName} - ${song.artistName}</div><button>Play</button>`;
    div.querySelector('button').onclick = () => playSong(song);
    container.appendChild(div);
  });
}

function playSong(song) {
  stopYouTube();
  if(currentAudio){ currentAudio.pause(); clearInterval(progressInterval); }
  currentAudio = new Audio(song.previewUrl);
  currentAudio.play(); isYouTube=false;
  nowPlayingTitle.textContent = `${song.trackName} - ${song.artistName}`;
  playPauseBtn.textContent = 'Pause';
  progressBar.value = 0;
  progressInterval = setInterval(() => {
    if (currentAudio && currentAudio.duration) {
      progressBar.value = (currentAudio.currentTime / currentAudio.duration) * 100;
    }
  }, 500);
  currentAudio.onended = ()=>{ nowPlayingTitle.textContent='No song playing'; progressBar.value=0; playPauseBtn.textContent='Play'; clearInterval(progressInterval); currentAudio=null; };
}

function playYouTube() {
  const url = document.getElementById('youtubeLink').value.trim();
  if(!url) return alert("Paste a YouTube link");
  stopAudio();
  const id = extractID(url);
  youtubePlayer.src = `https://www.youtube.com/embed/${id}?autoplay=1&rel=0`;
  youtubePlayer.style.display='block';
  isYouTube=true;
  nowPlayingTitle.textContent = "Loading YouTube...";
  fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${id}&key=${API_KEY}`)
    .then(res=>res.json()).then(data=>{
      if(data.items && data.items.length){
        const video = data.items[0];
        nowPlayingTitle.textContent = video.snippet.title;
      } else { nowPlayingTitle.textContent = 'Unknown video'; }
    }).catch(e=>{ console.error(e); nowPlayingTitle.textContent='Unknown video'; });
}

function extractID(url){ let m = url.match(/(?:v=|\/v\/|youtu\.be\/|embed\/)([A-Za-z0-9_\-]{6,})/); return m && m[1] ? m[1] : url; }

playPauseBtn.addEventListener('click',()=>{
  if(isYouTube){ 
    alert("YouTube playback controls are in the video player."); 
  } else if(currentAudio){
    if(currentAudio.paused){ currentAudio.play(); playPauseBtn.textContent='Pause'; }
    else{ currentAudio.pause(); playPauseBtn.textContent='Play'; }
  }
});

function stopAudio(){ if(currentAudio){ currentAudio.pause(); clearInterval(progressInterval); currentAudio=null; progressBar.value=0; } }
function stopYouTube(){ youtubePlayer.src='about:blank'; youtubePlayer.style.display='none'; }

</script>
</body>
</html>