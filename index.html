<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>WinTube Music - Spotify Style</title>
<style>
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: #121212;
  color: #fff;
}

.page-content {
  max-width: 900px;
  margin: 100px auto 50px;
  padding: 20px;
}

.music-box {
  background: #1e1e1e;
  padding: 20px;
  border-radius: 12px;
}

.music-box input {
  width: 70%;
  padding: 10px;
  margin-right: 10px;
  border-radius: 6px;
  border: none;
}

.music-box button {
  padding: 10px 16px;
  border-radius: 6px;
  border: none;
  background: #1db954;
  color: white;
  cursor: pointer;
}

#musicResults {
  margin-top: 20px;
}

.song-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 10px;
  border-radius: 8px;
  background: #2a2a2a;
  margin-bottom: 10px;
  cursor: pointer;
  transition: background 0.2s;
}

.song-item:hover {
  background: #333;
}

.song-item img {
  width: 60px;
  height: 60px;
  border-radius: 6px;
}

.song-info {
  flex: 1;
}

#nowPlayingBar {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: #181818;
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 10px 20px;
  border-top: 1px solid #333;
}

#nowPlayingBar img {
  width: 60px;
  height: 60px;
  border-radius: 6px;
}

#nowPlayingInfo {
  flex: 1;
  font-weight: bold;
}

#progressBar {
  width: 200px;
}

#playPauseBtn {
  padding: 6px 12px;
  background: #1db954;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
</style>
</head>
<body>

<div class="page-content">
  <div class="music-box">
    <input type="text" id="musicSearch" placeholder="Search iTunes...">
    <button onclick="searchMusic()">Search</button>
    <div id="musicResults"></div>
  </div>
</div>

<div id="nowPlayingBar">
  <img id="nowPlayingArt" src="" alt="" style="display:none;">
  <div id="nowPlayingInfo">No song playing</div>
  <input type="range" id="progressBar" value="0" min="0" max="100">
  <button id="playPauseBtn">Play</button>
</div>

<script>
let currentAudio = null, progressInterval = null;

const nowPlayingTitle = document.getElementById('nowPlayingInfo');
const nowPlayingArt = document.getElementById('nowPlayingArt');
const progressBar = document.getElementById('progressBar');
const playPauseBtn = document.getElementById('playPauseBtn');

function searchMusic() {
  const query = document.getElementById('musicSearch').value.trim();
  if (!query) return alert("Enter a song or artist");
  fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=song&limit=10`)
    .then(res => res.json())
    .then(data => displayMusic(data.results))
    .catch(err => console.error(err));
}

function displayMusic(songs) {
  const container = document.getElementById('musicResults');
  container.innerHTML = "";
  if (!songs.length) return container.innerHTML = "<p>No songs found.</p>";
  songs.forEach(song => {
    const div = document.createElement('div');
    div.className = 'song-item';
    div.innerHTML = `
      <img src="${song.artworkUrl100}">
      <div class="song-info">${song.trackName} - ${song.artistName}</div>
    `;
    div.onclick = () => playSong(song);
    container.appendChild(div);
  });
}

function playSong(song) {
  if(currentAudio){ currentAudio.pause(); clearInterval(progressInterval); }
  currentAudio = new Audio(song.previewUrl);
  currentAudio.play();
  nowPlayingTitle.textContent = `${song.trackName} - ${song.artistName}`;
  nowPlayingArt.src = song.artworkUrl100;
  nowPlayingArt.style.display = 'block';
  playPauseBtn.textContent = 'Pause';
  progressBar.value = 0;

  progressInterval = setInterval(() => {
    if(currentAudio && currentAudio.duration){
      progressBar.value = (currentAudio.currentTime / currentAudio.duration) * 100;
    }
  }, 500);

  currentAudio.onended = () => {
    nowPlayingTitle.textContent = 'No song playing';
    nowPlayingArt.style.display = 'none';
    progressBar.value = 0;
    playPauseBtn.textContent = 'Play';
    clearInterval(progressInterval);
    currentAudio = null;
  };
}

playPauseBtn.addEventListener('click',()=>{
  if(currentAudio){
    if(currentAudio.paused){
      currentAudio.play();
      playPauseBtn.textContent='Pause';
    } else {
      currentAudio.pause();
      playPauseBtn.textContent='Play';
    }
  }
});
</script>
</body>
</html>